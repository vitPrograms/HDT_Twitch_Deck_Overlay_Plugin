<UserControl x:Class="TwitchDeckOverlay.UI.ImprovedOverlayView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:TwitchDeckOverlay.UI"
             xmlns:models="clr-namespace:TwitchDeckOverlay.Models"
             xmlns:ext="clr-namespace:Hearthstone_Deck_Tracker.Utility.Extensions;assembly=HearthstoneDeckTracker"
             xmlns:tooltips="clr-namespace:Hearthstone_Deck_Tracker.Controls.Tooltips;assembly=HearthstoneDeckTracker"
             mc:Ignorable="d" 
             Width="520" MinHeight="60" MaxHeight="800"
             Background="Transparent"
             Opacity="0.95"
             MouseEnter="UserControl_MouseEnter"
             MouseLeave="UserControl_MouseLeave"
             UseLayoutRounding="True"
             TextOptions.TextFormattingMode="Display"
             TextOptions.TextRenderingMode="ClearType"
             RenderOptions.ClearTypeHint="Enabled">

    <UserControl.Resources>
        <local:RarityColorConverter x:Key="RarityColorConverter"/>
        <local:NullToVisibilityConverter x:Key="NullToVisibilityConverter"/>
        <local:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter"/>
        <local:PercentageConverter x:Key="PercentageConverter"/>
        
        <!-- Стиль для заголовка -->
        <Style x:Key="HeaderStyle" TargetType="Border">
            <Setter Property="Background" Value="#FF2D2D30"/>
            <Setter Property="BorderBrush" Value="#FF404040"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="10,8"/>
        </Style>
        
        <!-- Стиль для кнопок управління -->
        <Style x:Key="ControlButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Foreground" Value="#FFD4D4D4"/>
            <Setter Property="Width" Value="20"/>
            <Setter Property="Height" Value="20"/>
            <Setter Property="Margin" Value="2,0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" 
                                CornerRadius="2">
                            <ContentPresenter HorizontalAlignment="Center" 
                                            VerticalAlignment="Center"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter Property="Background" Value="#FF404040"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Стиль для елементів списку колод -->
        <Style x:Key="DeckItemStyle" TargetType="Border">
            <Setter Property="Background" Value="#FF252526"/>
            <Setter Property="BorderBrush" Value="#FF404040"/>
            <Setter Property="BorderThickness" Value="0,0,0,1"/>
            <Setter Property="Padding" Value="10,8"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FF2D2D30"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <!-- Анімація обертання для логотипу завантаження -->
        <Storyboard x:Key="LoadingRotationAnimation" RepeatBehavior="Forever">
            <DoubleAnimation Storyboard.TargetProperty="(UIElement.RenderTransform).(RotateTransform.Angle)"
                             From="0" To="360" Duration="0:0:1" />
        </Storyboard>

        <!-- Анімація стрибка для логотипу завантаження -->
        <Storyboard x:Key="LoadingJumpAnimation" RepeatBehavior="Forever">
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[0].(TranslateTransform.Y)"
                                         Duration="0:0:0.8">
                <LinearDoubleKeyFrame KeyTime="0%" Value="0"/>
                <LinearDoubleKeyFrame KeyTime="25%" Value="-8"/>
                <LinearDoubleKeyFrame KeyTime="50%" Value="0"/>
                <LinearDoubleKeyFrame KeyTime="75%" Value="-4"/>
                <LinearDoubleKeyFrame KeyTime="100%" Value="0"/>
            </DoubleAnimationUsingKeyFrames>
            <DoubleAnimationUsingKeyFrames Storyboard.TargetProperty="(UIElement.RenderTransform).(TransformGroup.Children)[1].(ScaleTransform.ScaleX)"
                                         Duration="0:0:0.8">
                <LinearDoubleKeyFrame KeyTime="0%" Value="1"/>
                <LinearDoubleKeyFrame KeyTime="49%" Value="1"/>
                <LinearDoubleKeyFrame KeyTime="50%" Value="-1"/>
                <LinearDoubleKeyFrame KeyTime="99%" Value="-1"/>
                <LinearDoubleKeyFrame KeyTime="100%" Value="1"/>
            </DoubleAnimationUsingKeyFrames>
        </Storyboard>

        <!-- Стиль для ComboBox -->
        <Style TargetType="ComboBox">
            <Setter Property="Background" Value="#FF3C4043"/>
            <Setter Property="BorderBrush" Value="#FF3C4043"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="Foreground" Value="#FFD4D4D4"/>
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBox">
                        <Grid>
                            <ToggleButton x:Name="ToggleButton"
                                          Grid.Column="2"
                                          Focusable="False"
                                          IsChecked="{Binding Path=IsDropDownOpen, Mode=TwoWay, RelativeSource={RelativeSource TemplatedParent}}"
                                          ClickMode="Press">
                                <ToggleButton.Template>
                                    <ControlTemplate TargetType="ToggleButton">
                                        <Border Background="#FF3C4043"
                                                BorderBrush="#FF3C4043"  
                                                BorderThickness="1"
                                                CornerRadius="3">
                                            <Grid>
                                                <Grid.ColumnDefinitions>
                                                    <ColumnDefinition />
                                                    <ColumnDefinition Width="20" />
                                                </Grid.ColumnDefinitions>
                                                <Border Grid.Column="1" Margin="1" Background="#FF5A5A5A" CornerRadius="2">
                                                    <Path x:Name="Arrow" Grid.Column="1" Fill="{TemplateBinding Foreground}" HorizontalAlignment="Center" VerticalAlignment="Center"
                                                          Data="M0,0 L4,4 L8,0 Z" />
                                                </Border>
                                            </Grid>
                                        </Border>
                                    </ControlTemplate>
                                </ToggleButton.Template>
                            </ToggleButton>
                            <ContentPresenter x:Name="ContentSite"
                                              IsHitTestVisible="False"
                                              ContentTemplate="{TemplateBinding SelectionBoxItemTemplate}"
                                              Content="{TemplateBinding SelectionBoxItem}"
                                              ContentStringFormat="{TemplateBinding SelectionBoxItemStringFormat}"
                                              Margin="5,2,25,2"
                                              VerticalAlignment="Center"
                                              HorizontalAlignment="Left"/>
                            <TextBox x:Name="PART_EditableTextBox"
                                     Style="{x:Null}"
                                     Template="{x:Null}"
                                     HorizontalAlignment="Left"
                                     VerticalAlignment="Center"
                                     Margin="4,1,24,1"
                                     Focusable="True"
                                     Background="Transparent"
                                     Visibility="Hidden"
                                     IsReadOnly="{TemplateBinding IsReadOnly}"/>
                            <Popup x:Name="Popup"
                                   Placement="Bottom"
                                   IsOpen="{TemplateBinding IsDropDownOpen}"
                                   AllowsTransparency="True"
                                   Focusable="False"
                                   PopupAnimation="Slide">
                                <Grid MaxHeight="{TemplateBinding MaxDropDownHeight}"
                                      MinWidth="{TemplateBinding ActualWidth}"
                                      SnapsToDevicePixels="True">
                                    <Border x:Name="DropDownBorder"
                                            Background="#FF252526"
                                            BorderThickness="1"
                                            BorderBrush="#FF404040"/>
                                    <ScrollViewer Margin="4,6,4,6" SnapsToDevicePixels="True">
                                        <StackPanel>
                                            <ItemsPresenter KeyboardNavigation.DirectionalNavigation="Contained" />
                                        </StackPanel>
                                    </ScrollViewer>
                                </Grid>
                            </Popup>
                        </Grid>
                        <ControlTemplate.Triggers>
                            <Trigger Property="HasItems" Value="False">
                                <Setter TargetName="DropDownBorder" Property="MinHeight" Value="95"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#FF888888"/>
                            </Trigger>
                            <Trigger Property="IsGrouping" Value="True">
                                <Setter Property="ScrollViewer.CanContentScroll" Value="False"/>
                            </Trigger>
                            <Trigger SourceName="Popup" Property="Popup.AllowsTransparency" Value="True">
                                <Setter TargetName="DropDownBorder" Property="CornerRadius" Value="3"/>
                                <Setter TargetName="DropDownBorder" Property="Margin" Value="0,2,0,0"/>
                            </Trigger>
                            <Trigger Property="IsEditable" Value="True">
                                <Setter Property="IsTabStop" Value="False"/>
                                <Setter TargetName="PART_EditableTextBox" Property="Visibility" Value="Visible"/>
                                <Setter TargetName="ContentSite" Property="Visibility" Value="Hidden"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- Стиль для ComboBoxItem -->
        <Style TargetType="ComboBoxItem">
            <Setter Property="SnapsToDevicePixels" Value="True"/>
            <Setter Property="Padding" Value="8,4"/>
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="#FFD4D4D4"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ComboBoxItem">
                        <Border x:Name="Border"
                                Padding="{TemplateBinding Padding}"
                                SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}"
                                Background="{TemplateBinding Background}">
                            <ContentPresenter />
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#FF505050"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="Border" Property="Background" Value="#FF606060"/>
                                <Setter Property="Foreground" Value="White"/>
                            </Trigger>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="#FF888888"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="280"/>
            <ColumnDefinition Width="230"/>
        </Grid.ColumnDefinitions>
        <Border Grid.Column="0" 
                CornerRadius="6" 
                Background="#FF1E1E1E" 
                BorderBrush="#FF404040" 
                BorderThickness="1"
                MaxHeight="600"
                VerticalAlignment="Top">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                    <RowDefinition Height="Auto"/>
                </Grid.RowDefinitions>
            <Border Grid.Row="0" Style="{StaticResource HeaderStyle}"
                    x:Name="DragHandle"
                    MouseLeftButtonDown="DragHandle_MouseLeftButtonDown"
                    MouseLeftButtonUp="DragHandle_MouseLeftButtonUp"
                    MouseMove="DragHandle_MouseMove"
                    MouseEnter="Header_MouseEnter"
                    Cursor="SizeAll">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>
                    
                    <!-- Заголовок -->
                    <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="TWITCH DECKS" 
                                   FontWeight="Bold" 
                                   FontSize="14" 
                                   Foreground="#FFD4D4D4" 
                                   Margin="0,0,10,0"/>
                        <TextBlock Text="{Binding TwitchChannel, StringFormat='#{0}'}" 
                                   FontSize="12" 
                                   Foreground="#FF888888"/>
                    </StackPanel>
                    
                    <!-- Кнопки управління -->
                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <Button Style="{StaticResource ControlButtonStyle}" 
                                Click="PasteDeckCodeButton_Click"
                                ToolTip="Paste Deck Code">
                            <TextBlock Text="📋" FontSize="14" FontWeight="Bold"/>
                        </Button>
                        <Button Style="{StaticResource ControlButtonStyle}" 
                                Click="MinimizeButton_Click"
                                ToolTip="Minimize">
                            <TextBlock Text="−" FontSize="14" FontWeight="Bold"/>
                        </Button>
                        <Button Style="{StaticResource ControlButtonStyle}" 
                                Click="CloseButton_Click"
                                ToolTip="Close">
                            <TextBlock Text="×" FontSize="14" FontWeight="Bold"/>
                        </Button>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Список колод -->
            <ScrollViewer Grid.Row="1"
                          x:Name="DeckListScrollViewer" 
                          VerticalScrollBarVisibility="Auto" 
                          HorizontalScrollBarVisibility="Disabled"
                          MaxHeight="400">
                <ItemsControl ItemsSource="{Binding Decks}" x:Name="DeckItemsControl">
                    <ItemsControl.ItemTemplate>
                        <DataTemplate DataType="{x:Type models:DeckInfo}">
                            <local:DeckItemView DataContext="{Binding}" Loaded="DeckItemView_Loaded"/>
                        </DataTemplate>
                    </ItemsControl.ItemTemplate>
                </ItemsControl>
            </ScrollViewer>

            <!-- Панель деталей колоди (знизу) -->
            <Border Grid.Row="2" 
                    x:Name="DetailsPanel"
                    Background="#FF252526" 
                    BorderBrush="#FF404040" 
                    BorderThickness="0,1,0,0"
                    Padding="15"
                    Visibility="Collapsed">
                <StackPanel>
                    <!-- Заголовок з кнопкою закриття -->
                    <Grid Margin="0,0,0,15">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <TextBlock Grid.Column="0" 
                                   x:Name="DetailsTitle"
                                   Text="Deck Details" 
                                   FontWeight="Bold" 
                                   FontSize="16" 
                                   Foreground="#FFD4D4D4" 
                                   VerticalAlignment="Center"/>
                        
                        <Button Grid.Column="1" 
                                Style="{StaticResource ControlButtonStyle}" 
                                Click="CloseDetailsButton_Click"
                                ToolTip="Close Details">
                            <TextBlock Text="×" FontSize="14" FontWeight="Bold"/>
                        </Button>
                    </Grid>
                    
                    <!-- Основна інформація про колоду (компактно) -->
                    <Grid Margin="0,0,0,10">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="Auto"/>
                        </Grid.RowDefinitions>
                        
                        <!-- Перший рядок: Клас, режим і кнопки -->
                        <Grid Grid.Row="0" Margin="0,0,0,8">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Ліва частина: Іконка класу і назва -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal" VerticalAlignment="Center">
                                <StackPanel Orientation="Vertical" Margin="0,0,8,0">
                                    <Border Width="28" Height="28" 
                                            CornerRadius="14" 
                                            Background="#FF404040">
                                        <TextBlock x:Name="DetailsArchetype" 
                                                   Text="⚡" 
                                                   Foreground="#FF56CCF2" 
                                                   FontWeight="Bold" 
                                                   FontSize="16" 
                                                   HorizontalAlignment="Center" 
                                                   VerticalAlignment="Center"
                                                   ToolTip="Deck Archetype"/>
                                    </Border>
                                    <TextBlock x:Name="DetailsArchetypeText" 
                                               Text="Archetype" 
                                               FontSize="8" 
                                               Foreground="#FFB8B8B8" 
                                               HorizontalAlignment="Center" 
                                               Margin="0,1,0,0"
                                               Visibility="Collapsed"/>
                                </StackPanel>
                                
                                <StackPanel>
                                    <Grid>
                                        <TextBlock x:Name="DetailsDeckTitle" Text="Deck: Unknown" FontSize="14" FontWeight="Bold" Foreground="White"/>
                                        <Image x:Name="HSGuruLogoTitle" Source="/Assets/hsguru-logo.png" Width="12" Height="12" 
                                               HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,-2,0,0" 
                                               Visibility="Collapsed" ToolTip="Data from HSGuru"/>
                                    </Grid>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock x:Name="DetailsClass" Text="Unknown" FontSize="11" Foreground="#FFB8B8B8" Margin="0,0,8,0"/>
                                        <TextBlock x:Name="DetailsMode" Text="Unknown" FontSize="11" Foreground="#FFB8B8B8"/>
                                    </StackPanel>
                                </StackPanel>
                            </StackPanel>
                            
                            <!-- Кнопки дій -->
                            <StackPanel Grid.Column="2" Orientation="Vertical" VerticalAlignment="Center" HorizontalAlignment="Right">
                                <Border Background="#FF3C4043" BorderBrush="#FF5A5A5A" BorderThickness="1" 
                                        CornerRadius="3" Padding="4,2" Margin="0,0,0,2"
                                        MouseLeftButtonDown="CopyDeckCodeDetails_Click"
                                        ToolTip="Copy Deck Code" Cursor="Hand">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Opacity" Value="0.8"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#FF56CCF2"/>
                                                    <Setter Property="BorderBrush" Value="#FF56CCF2"/>
                                                    <Setter Property="Opacity" Value="1.0"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="📋" FontSize="12" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="#FF56CCF2">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Border}, Path=IsMouseOver}" Value="True">
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                                <Border Background="#FF3C4043" BorderBrush="#FF5A5A5A" BorderThickness="1" 
                                        CornerRadius="3" Padding="4,2"
                                        MouseLeftButtonDown="RemoveDeckDetails_Click"
                                        ToolTip="Remove Deck" Cursor="Hand">
                                    <Border.Style>
                                        <Style TargetType="Border">
                                            <Setter Property="Opacity" Value="0.8"/>
                                            <Style.Triggers>
                                                <Trigger Property="IsMouseOver" Value="True">
                                                    <Setter Property="Background" Value="#FFEB5757"/>
                                                    <Setter Property="BorderBrush" Value="#FFEB5757"/>
                                                    <Setter Property="Opacity" Value="1.0"/>
                                                </Trigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Border.Style>
                                    <TextBlock Text="❌" FontSize="12" VerticalAlignment="Center" HorizontalAlignment="Center" Foreground="#FFEB5757">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding RelativeSource={RelativeSource AncestorType=Border}, Path=IsMouseOver}" Value="True">
                                                        <Setter Property="Foreground" Value="White"/>
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </Border>
                            </StackPanel>
                        </Grid>

                        <!-- HSGuru Filters -->
                        <Grid Grid.Row="1" Margin="0,5,0,5">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>

                            <!-- HSGuru Logo -->
                            <Image Grid.Column="0" Source="/TwitchDeckOverlay;component/Assets/hsguru-logo.png" Width="24" Height="24" VerticalAlignment="Center" HorizontalAlignment="Left" Margin="0,0,8,0">
                                <Image.RenderTransform>
                                    <TransformGroup>
                                        <TranslateTransform />
                                        <ScaleTransform CenterX="12" CenterY="12" />
                                    </TransformGroup>
                                </Image.RenderTransform>
                                <Image.Style>
                                    <Style TargetType="Image">
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding IsLoadingHSGuruData}" Value="True">
                                                <DataTrigger.EnterActions>
                                                    <BeginStoryboard Storyboard="{StaticResource LoadingJumpAnimation}" x:Name="LoadingJumpAnimationBegin"/>
                                                </DataTrigger.EnterActions>
                                                <DataTrigger.ExitActions>
                                                    <StopStoryboard BeginStoryboardName="LoadingJumpAnimationBegin"/>
                                                </DataTrigger.ExitActions>
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </Image.Style>
                            </Image>

                            <!-- Rank ComboBox -->
                            <ComboBox Grid.Column="1" x:Name="HSGuruRankFilterComboBox"
                                      Margin="0,0,5,0"
                                      HorizontalAlignment="Stretch"
                                      ToolTip="Filter by Rank">
                                <ComboBoxItem Content="All Ranks" Tag="all"/>
                                <ComboBoxItem Content="Diamond to Legend" Tag="diamond_to_legend"/>
                                <ComboBoxItem Content="Diamond 4-1" Tag="diamond_4to1"/>
                                <ComboBoxItem Content="Legend" Tag="legend"/>
                                <ComboBoxItem Content="Top 5000" Tag="top_5k"/>
                                <ComboBoxItem Content="Top Legend" Tag="top_legend"/>
                            </ComboBox>

                            <!-- Period ComboBox -->
                            <ComboBox Grid.Column="2" x:Name="HSGuruPeriodFilterComboBox"
                                      Margin="5,0,0,0"
                                      HorizontalAlignment="Stretch"
                                      ToolTip="Filter by Time Period">
                                <ComboBoxItem Content="Past Week" Tag="past_week"/>
                                <ComboBoxItem Content="Past 3 Days" Tag="past_3_days"/>
                                <ComboBoxItem Content="Past Day" Tag="past_day"/>
                                <ComboBoxItem Content="Past 6 Hours" Tag="past_6_hours"/>
                            </ComboBox>
                        </Grid>

                        <!-- Другий рядок: Статистика з іконками -->
                        <Grid Grid.Row="2" Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Блок винрейту -->
                            <Border Grid.Column="0" Background="#FF3C4043" CornerRadius="6" Padding="6,8" Margin="0,0,4,0" BorderBrush="#FF5A5A5A" BorderThickness="1">
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <TextBlock Text="🎯" FontSize="16" HorizontalAlignment="Center" Margin="0,0,0,4" Foreground="#FF56CCF2"/>
                                    <Grid HorizontalAlignment="Center">
                                        <TextBlock Text="Win Rate" FontSize="9" Foreground="#FFAAAAAA" HorizontalAlignment="Center" Margin="0,0,0,2"/>
                                        <Image x:Name="HSGuruLogoWinRate" Source="/Assets/hsguru-logo.png" Width="10" Height="10" 
                                               HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,-2,0,0" 
                                               Visibility="Collapsed" ToolTip="Data from HSGuru"/>
                                    </Grid>
                                    <TextBlock x:Name="DetailsWinRate" Text="--%" FontSize="13" FontWeight="Bold" Foreground="#FF56CCF2" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Блок ігор -->
                            <Border Grid.Column="1" Background="#FF3C4043" CornerRadius="6" Padding="6,8" Margin="0,0,4,0" BorderBrush="#FF5A5A5A" BorderThickness="1">
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <TextBlock Text="🎮" FontSize="16" HorizontalAlignment="Center" Margin="0,0,0,4" Foreground="#FF56CCF2"/>
                                    <Grid HorizontalAlignment="Center">
                                        <TextBlock Text="Games" FontSize="9" Foreground="#FFAAAAAA" HorizontalAlignment="Center" Margin="0,0,0,2"/>
                                        <Image x:Name="HSGuruLogoGames" Source="/Assets/hsguru-logo.png" Width="10" Height="10" 
                                               HorizontalAlignment="Right" VerticalAlignment="Top" Margin="0,-2,0,0" 
                                               Visibility="Collapsed" ToolTip="Data from HSGuru"/>
                                    </Grid>
                                    <TextBlock x:Name="DetailsTotalGames" Text="--" FontSize="13" FontWeight="Bold" Foreground="#FF56CCF2" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                            
                            <!-- Блок пилу -->
                            <Border Grid.Column="2" Background="#FF3C4043" CornerRadius="6" Padding="6,8" Margin="0,0,0,0" BorderBrush="#FF5A5A5A" BorderThickness="1">
                                <StackPanel HorizontalAlignment="Center" VerticalAlignment="Center">
                                    <TextBlock Text="✨" FontSize="16" HorizontalAlignment="Center" Margin="0,0,0,4" Foreground="#FFF2C94C"/>
                                    <TextBlock Text="Dust Cost" FontSize="9" Foreground="#FFAAAAAA" HorizontalAlignment="Center" Margin="0,0,0,2"/>
                                    <TextBlock x:Name="DetailsDustCost" Text="--" FontSize="13" FontWeight="Bold" Foreground="#FFF2C94C" HorizontalAlignment="Center"/>
                                    <TextBlock x:Name="DetailsDustNeeded" Text="" FontSize="9" Foreground="#FFEB5757" HorizontalAlignment="Center" Margin="0,1,0,0" Visibility="Collapsed"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                        
                        <!-- Третій рядок: Графік мани -->
                        <Grid Grid.Row="3" Margin="0,6,0,0">
                            <Border Background="#FF3C4043" CornerRadius="6" Padding="10,6" BorderBrush="#FF5A5A5A" BorderThickness="1">
                                <StackPanel>
                                    <TextBlock Text="Mana Curve" FontSize="10" Foreground="#FFAAAAAA" 
                                               HorizontalAlignment="Center" Margin="0,0,0,6"/>
                                    <Canvas x:Name="ManaCurveCanvas" Height="70" Width="180" HorizontalAlignment="Center"/>
                                </StackPanel>
                            </Border>
                        </Grid>
                        
                        <!-- Четвертий рядок: Матчапи -->
                        <Grid Grid.Row="4" Margin="0,6,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            
                            <!-- Додаткова інформація -->
                            <StackPanel Grid.Column="0" Orientation="Horizontal">
                                <!-- Легендарні карти -->
                                <Border Background="#FF3C4043" CornerRadius="4" Padding="8,6" 
                                        BorderBrush="#FF5A5A5A" BorderThickness="1" Margin="0,0,8,0">
                                    <Grid>
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto"/>
                                            <ColumnDefinition Width="*"/>
                                            <ColumnDefinition Width="Auto"/>
                                        </Grid.ColumnDefinitions>
                                        <TextBlock Grid.Column="0" Text="💎" FontSize="12" Margin="0,0,6,0" 
                                                   VerticalAlignment="Center" Foreground="#FFF2C94C"/>
                                        <TextBlock Grid.Column="1" Text="Legendary" FontSize="10" 
                                                   Foreground="#FFAAAAAA" VerticalAlignment="Center"/>
                                        <TextBlock Grid.Column="2" x:Name="DetailsLegendaryCount" Text="0" Margin="6,0,0,0"
                                                   Foreground="#FFF2C94C" FontSize="12" FontWeight="Bold"/>
                                    </Grid>
                                </Border>
                            </StackPanel>
                            
                            <!-- Кнопка матчапів з tooltip -->
                            <Border Grid.Column="1" x:Name="MatchupsButton" 
                                    Background="#FF3C4043" BorderBrush="#FF5A5A5A" BorderThickness="1" 
                                    CornerRadius="4" Padding="6,4" Margin="0,0,0,4" Cursor="Hand"
                                    MouseEnter="MatchupsButton_MouseEnter" 
                                    MouseLeave="MatchupsButton_MouseLeave">
                                <Border.Style>
                                    <Style TargetType="Border">
                                        <Setter Property="Opacity" Value="0.8"/>
                                        <Style.Triggers>
                                            <Trigger Property="IsMouseOver" Value="True">
                                                <Setter Property="Background" Value="#FF505050"/>
                                                <Setter Property="BorderBrush" Value="#FF707070"/>
                                                <Setter Property="Opacity" Value="1.0"/>
                                            </Trigger>
                                        </Style.Triggers>
                                    </Style>
                                </Border.Style>
                                <StackPanel Orientation="Horizontal">
                                    <TextBlock Text="⚔️" FontSize="12" Margin="0,0,4,0" VerticalAlignment="Center" Foreground="#FFD4D4D4"/>
                                    <TextBlock Text="Matchups ℹ️" FontSize="10" Foreground="#FFD4D4D4" VerticalAlignment="Center"/>
                                </StackPanel>
                                
                                <!-- Tooltip з матчапами -->
                                <Border.ToolTip>
                                    <ToolTip x:Name="MatchupsTooltip" Background="#FF2D2D30" BorderBrush="#FF404040" BorderThickness="1" Padding="12">
                                        <StackPanel x:Name="MatchupsTooltipContent" MaxWidth="250">
                                            <TextBlock Text="Class Matchups" FontSize="12" FontWeight="Bold" 
                                                       Foreground="#FFD4D4D4" Margin="0,0,0,8" HorizontalAlignment="Center"/>
                                            <!-- Динамічний контент буде додано в коді -->
                                        </StackPanel>
                                    </ToolTip>
                                </Border.ToolTip>
                            </Border>
                        </Grid>
                    </Grid>
                    
                    <!-- Список карт з HDT стилем -->
                    <Border BorderBrush="#FF404040" 
                            BorderThickness="0,1,0,0"
                            Padding="0,10,0,0">
                        <ScrollViewer VerticalScrollBarVisibility="Auto" 
                                      HorizontalScrollBarVisibility="Disabled"
                                      MaxHeight="300">
                            <ScrollViewer.Resources>
                                <!-- Стиль для ScrollBar -->
                                <Style TargetType="ScrollBar">
                                    <Setter Property="Background" Value="#FF2D2D30"/>
                                    <Setter Property="Foreground" Value="#FF404040"/>
                                    <Setter Property="Width" Value="12"/>
                                    <Setter Property="Template">
                                        <Setter.Value>
                                            <ControlTemplate TargetType="ScrollBar">
                                                <Grid Background="{TemplateBinding Background}">
                                                    <Track Name="PART_Track" IsDirectionReversed="True">
                                                        <Track.Thumb>
                                                            <Thumb Background="#FF606060" BorderBrush="#FF808080" BorderThickness="1">
                                                                <Thumb.Style>
                                                                    <Style TargetType="Thumb">
                                                                        <Setter Property="Template">
                                                                            <Setter.Value>
                                                                                <ControlTemplate TargetType="Thumb">
                                                                                    <Border Background="{TemplateBinding Background}" 
                                                                                            BorderBrush="{TemplateBinding BorderBrush}" 
                                                                                            BorderThickness="{TemplateBinding BorderThickness}"
                                                                                            CornerRadius="6"/>
                                                                                    <ControlTemplate.Triggers>
                                                                                        <Trigger Property="IsMouseOver" Value="True">
                                                                                            <Setter Property="Background" Value="#FF808080"/>
                                                                                        </Trigger>
                                                                                        <Trigger Property="IsDragging" Value="True">
                                                                                            <Setter Property="Background" Value="#FFA0A0A0"/>
                                                                                        </Trigger>
                                                                                    </ControlTemplate.Triggers>
                                                                                </ControlTemplate>
                                                                            </Setter.Value>
                                                                        </Setter>
                                                                    </Style>
                                                                </Thumb.Style>
                                                            </Thumb>
                                                        </Track.Thumb>
                                                    </Track>
                                                </Grid>
                                            </ControlTemplate>
                                        </Setter.Value>
                                    </Setter>
                                </Style>
                            </ScrollViewer.Resources>
                            <!-- Card list moved to separate overlay -->
                        </ScrollViewer>
                    </Border>
                </StackPanel>
            </Border>
            </Grid>
        </Border>
        
        <!-- Список карт (другий стовпець) з тонким фоном -->
        <Border Grid.Column="1" 
                Margin="10,0,0,0"
                x:Name="CardListColumn"
                Visibility="Collapsed"
                VerticalAlignment="Top"
                Background="#22000000"
                CornerRadius="4"
                BorderBrush="#33404040"
                BorderThickness="1">
                <ScrollViewer VerticalScrollBarVisibility="Auto" 
                              HorizontalScrollBarVisibility="Disabled"
                              Background="Transparent">
                    <ItemsControl x:Name="DetailsCardList">
                        <ItemsControl.ItemContainerStyle>
                            <Style>
                                <Setter Property="FrameworkElement.Margin" Value="0,1,0,0" />
                            </Style>
                        </ItemsControl.ItemContainerStyle>
                        <ItemsControl.ItemTemplate>
                            <DataTemplate>
                                <Rectangle Fill="{Binding Background}" Height="34" Width="217" 
                                           ToolTipService.Placement="Right"
                                           ToolTipService.InitialShowDelay="100"
                                           ext:OverlayExtensions.ToolTip="{x:Type tooltips:CardTooltip}" />
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>
                </ScrollViewer>
        </Border>
    </Grid>
</UserControl>